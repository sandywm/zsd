<!DOCTYPE html>
<html>
<head>
 	<meta charset="utf-8"/>
 	<link href="/plugins/layui/css/layui.css" rel="stylesheet" type="text/css"/>
 	<link href="/Module/lexManager/css/lexManager.css" rel="stylesheet" type="text/css"/>
 	<link href="/plugins/pace/pace-theme-flash.min.css" rel="stylesheet" type="text/css"/>
	<link href="/Module/commonJs/ueditor/themes/default/css/ueditor.min.css" type="text/css" rel="stylesheet" />
	<script src="/plugins/pace/pace.min.js" type="text/javascript"></script>	
  	<title>添加编辑词库</title>
</head>
<body style="background:#fff;">
	<div class="lexBox layui-clear">
		<div class="lexTit layui-form-item" style="margin-top:15px;margin-bottom:10px;">
			<label class="layui-form-label">词库标题：</label>
			<div class="layui-input-block" style="width:82%;">
				<input id="lexTit" type="text" placeholder="请输入词库标题" class="layui-input"/>
			</div>
		</div>
		<div class="lexCon layui-form-item">
			<label class="layui-form-label">词库内容：</label>
			<div class="layui-input-block" style="width:82%;">
				<div id="lexEditor"></div>
			</div>
		</div>
	</div>	
	<div class="lexBot">
		<button id="addLexBtn" class="layui-btn">添加</button>
	</div>
	
	<script src="/plugins/jquery/jquery.min.js"></script>
	<script src="/plugins/layui/layui.js"></script>
	<script src="/Module/commonJs/ueditor/ueditor.config.js"></script>
	<script src="/Module/commonJs/ueditor/ueditor.all.min.js"></script>
	<script type="text/javascript">
		var globalOpts = parent.globalOpts,currLexId = parent.currLexId;
		layui.use(['layer'],function(){
			var layer = layui.layer;
			var page = {
				init : function(){
					this.loadLexInfo();
					this.initUeditor('lexEditor');
					this.bindEvent();
				},
				loadLexInfo : function(){
					var _this = this;
					if(globalOpts == 'edit'){
						layer.load('1');
	    				$.ajax({
	    					type:'post',
	    			        dataType:'json',
	    			        data:{lexId:currLexId},
	    			        url:'/lex.do?action=getLexDetail',
	    			        success:function (json){
	    			        	layer.closeAll('loading');	
	    			        	if(json.result == 'success'){
	    			        		$('#lexTit').val(json.lexTitle);
	    			        		_this.initUeditorContent('lexEditor',json.lexContent);
	    			        	}else if(json.result == 'noInfo'){
	    			        		layer.msg('暂无此词库信息', {icon:5,anim:6,time:2000});
	    			        	}
	    			        }
	    				});
					}
				},
				initUeditor : function(id){
					UE.getEditor(id,{
						initialFrameWidth : '100%',
						initialFrameHeight : 260,
						wordCount:true,
						textarea : 'description'
					});
				},
				initUeditorContent : function(obj,content){
		    		UE.getEditor(obj).addListener("ready", function () {
				        // editor准备好之后才可以使用
				        UE.getEditor(obj).setContent(content,null);
					});
		    	},
		    	bindEvent : function(){
		    		$('#addLexBtn').on('click',function(){
		    			var lexTit = $.trim($('#lexTit').val()),
		    				lexCon = UE.getEditor('lexEditor').getContent();
		    			if(lexTit == ''){
		    				layer.msg('请填写词库标题', {icon:5,anim:6,time:2000});
		    			}else if(lexCon == ''){
		    				layer.msg('请填写词库内容', {icon:5,anim:6,time:2000});
		    			}else{
		    				layer.load('1');
		    				var field = null,url='';
		    				if(globalOpts == 'add'){
		    					field = {lexTitle:lexTit,lexContent:lexCon};
		    					url = '/lex.do?action=addLex';
		    				}else{
		    					field = {lexId:currLexId,lexTitle:lexTit,lexContent:lexCon};
		    					url = '/lex.do?action=updateLex';
		    				}
		    				$.ajax({
		    					type:'post',
		    			        dataType:'json',
		    			        data:field,
		    			        url:url,
		    			        success:function (json){
		    			        	layer.closeAll('loading');	
		    			        	var title = globalOpts == 'add' ? '添加词库成功' : '编辑词库成功';
		    			        	if(json.result == 'success'){
		    			        		layer.msg(title,{icon:1,time:1000},function(){
		    			        			var index= parent.layer.getFrameIndex(window.name);
						        			parent.addEditFlag = true;
						        			parent.layer.close(index);
		   				        		});
		    			        	}
		    			        }
		    				});
		    			}
		    		});
		    	}
			};
			page.init();
		});
	</script>
</body> 
</html>