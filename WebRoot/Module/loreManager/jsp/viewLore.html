<!DOCTYPE html>
<html>
<head>
 	<meta charset="utf-8"/>
 	<link href="/plugins/layui/css/layui.css" rel="stylesheet" type="text/css"/>
 	<link href="/Module/loreManager/css/viewLore.css" rel="stylesheet" type="text/css"/>
 	<link href="/plugins/pace/pace-theme-flash.min.css" rel="stylesheet" type="text/css"/>
	<script src="/plugins/pace/pace.min.js" type="text/javascript"></script>	
  	<title>浏览知识点</title>
</head>
<body>
	<div class="viewLoreWrap">
		<ul class="loreNav">
			<li class="active" currPos="zsqdTit">知识清单</li>
			<li currPos="dbzdTit">点拨指导</li>
			<li currPos="jtsfTit">解题示范</li>
			<li currPos="ggxlTit">巩固训练</li>
			<li currPos="zdxzdTit">针对性诊断</li>
			<li currPos="zczdTit">再次诊断</li>
			<li currPos="zsjjTit">知识讲解</li>
		</ul>
		<div class="loreDetCon">
			<!-- 知识清单 -->
			<div class="comLoreCon zsqdLore">
				<strong id="zsqdTit" class="titStrong">知识清单</strong>
				<div id="zsqdLore"></div>
			</div>
			<!-- 点拨指导 -->
			<div class="comLoreCon dbzdLore">
				<strong id="dbzdTit" class="titStrong">点拨指导</strong>
				<div id="dbzdLore"></div>
			</div>
			<!-- 解题示范 -->
			<div class="comLoreCon jtsfLore">
				<strong id="jtsfTit" class="titStrong">解题示范</strong>
				<div id="jtsfLore"></div>
			</div>
			<!-- 巩固训练 -->
			<div class="comLoreCon ggxlLore">
				<strong id="ggxlTit" class="titStrong">巩固训练</strong>
				<div id="ggxlLore"></div>
			</div>
			<!-- 针对性诊断 -->
			<div class="comLoreCon zdxzdLore">
				<strong id="zdxzdTit" class="titStrong">针对性诊断</strong>
				<div id="zdxzdLore"></div>
			</div>
			<!-- 再次诊断 -->
			<div class="comLoreCon zczdLore">
				<strong id="zczdTit" class="titStrong">再次诊断</strong>
				<div id="zczdLore"></div>
			</div>
			<!-- 知识讲解 -->
			<div class="comLoreCon zsjjLore">
				<strong id="zsjjTit" class="titStrong">知识讲解</strong>
				<div id="zsjjLore"></div>
			</div>
		</div>
	</div>
	

	<script src="/plugins/jquery/jquery.min.js"></script>
	<script src="/plugins/layui/layui.js"></script>
	<script type="text/javascript">
		var loreId = parent.loreId;
		layui.use(['layer'],function(){
			var layer = layui.layer;
			var page = {
				init : function(){
					this.loadLoreDetail();	
				},
				loadLoreDetail : function(){
					layer.load('1');
					var _this = this;
					$.ajax({
						type:'post',
					    dataType:'json',
					    data:{loreId:loreId},
					    url:'/lore.do?action=getLoreQuestionData',
					    success:function (json){
					    	layer.closeAll('loading');	
					    	if(json.result == 'success'){
						    	_this.renderZsqdInfo(json.zsqdList);
						    	_this.renderDbzdInfo(json.dbzdList);
						    	_this.renderJtsfInfo(json.jtsfList);
						    	_this.renderGgxlInfo(json.ggxlList);
						    	_this.renderZdxzdInfo(json.zdxList);
						    	_this.renderZczdInfo(json.zczdList);
						    	_this.renderZsjjInfo(json.zsjjList);
						    	_this.goTarget();
					    	}else if(json.result == 'noInfo'){
					    		layer.msg('暂无此知识点的题库信息',{icon:5,anim:6,time:2000});
					    	}
					    	
					    }
					});
				},
				goTarget : function(){
					$('.loreNav').on('click','li',function(){
						var currPos = $(this).attr('currPos'),pos = 0;
						$(this).addClass('active').siblings().removeClass('active');
						pos = document.getElementById(currPos).offsetTop;
						$('.loreDetCon').stop().animate({scrollTop:pos},900);
					});
					$('.loreDetCon').on('scroll',function(){
						var scrollTop = $(this).scrollTop();
						var posTop = document.querySelectorAll('.titStrong');
						for(var i=0;i<posTop.length;i++){
							if(posTop[i].offsetTop <= scrollTop){
								$('.loreNav li').removeClass('active');
								$('.loreNav li').eq(i).addClass('active');
							}
						}
					});
				},
				//知识讲解
				renderZsjjInfo : function(zsjjList){
					var zsjjStr = '';
					for(var i=0;i<zsjjList.length;i++){
						zsjjStr += '<div class="listLore">';
						zsjjStr += '<div class="con hasMargBot"><p class="titP">题干：</p><div>'+ zsjjList[i].queSub +'</div></div>';
						zsjjStr += '<div class="con"><p class="titP">视频：</p><div><img class="showVideoBtn" alt="'+ zsjjList[i].videoPath +'" src="../images/video.jpg"/></div></div>';
						zsjjStr += '</div>';
					}
					$('#zsjjLore').html(zsjjStr);
					$('.showVideoBtn').on('click',function(){
						window.localStorage.removeItem("videoPath");
						var videoPath = $(this).attr('alt');
						window.localStorage.setItem("videoPath",videoPath);
						if(videoPath.indexOf('flv') > 0){
							window.top.layer.open({
								title:'视频文件播放窗口',
								type: 2,
							  	area: ['700px', '500px'],
							  	fixed: true, //不固定
							  	maxmin: false,
							  	shadeClose :false,
							  	content: '/Module/loreManager/jsp/playVideo.html',
							  	end : function(){
							  		window.localStorage.removeItem("videoPath");
							  	}
							});	
						}else{
							layer.msg('暂不支持该视频格式播放',{icon:5,anim:6,time:2000});
						}
						
					});
				},
				//再次诊断
				renderZczdInfo : function(zczdList){
					this.commonRenderInfo(zczdList,'zczdLore');
				},
				//针对性诊断
				renderZdxzdInfo : function(zdxList){
					this.commonRenderInfo(zdxList,'zdxzdLore');
				},
				//巩固训练
				renderGgxlInfo : function(ggxlList){
					this.commonRenderInfo(ggxlList,'ggxlLore');
				},
				//巩固训练 针对性诊断 再次诊公共方法
				commonRenderInfo : function(list,obj){
					if(list != null){
						var listStr = '';
						for(var i=0;i<list.length;i++){
							listStr += '<div class="listLore">';
							listStr += '<strong class="smTit">标题：'+ list[i].queTitle +'  <span class="queType">'+ list[i].queType +'</span><span class="queType1">'+ list[i].queType2 +'</span></strong>';
							//题干
							listStr += '<div class="con"><p class="titP">题干：</p><div>'+ list[i].queSub +'</div></div>';
							//选项
							listStr += '<div class="conSelOpt">';
								if(list[i].answerA != ''){
									listStr += '<div class="comOpt layui-clear"><span class="queSelWord">A：</span>';
										if(this.checkAnswerImg(list[i].answerA)){
											listStr += '<p><img src="'+ list[i].answerA +'"/></p>';
										}else{
											listStr += '<p>'+ list[i].answerA.replace("<","&lt") +'</p>';
										}
									listStr += '</div>';
								}
								if(list[i].answerB != ''){
									listStr += '<div class="comOpt layui-clear"><span class="queSelWord">B：</span>';
										if(this.checkAnswerImg(list[i].answerB)){
											listStr += '<p><img src="'+ list[i].answerB +'"/></p>';
										}else{
											listStr += '<p>'+ list[i].answerB.replace("<","&lt") +'</p>';
										}
									listStr += '</div>';
								}
								if(list[i].answerC != ''){
									listStr += '<div class="comOpt layui-clear"><span class="queSelWord">C：</span>';
										if(this.checkAnswerImg(list[i].answerC)){
											listStr += '<p><img src="'+ list[i].answerC +'"/></p>';
										}else{
											listStr += '<p>'+ list[i].answerC.replace("<","&lt") +'</p>';
										}
									listStr += '</div>';
								}
								if(list[i].answerD != ''){
									listStr += '<div class="comOpt layui-clear"><span class="queSelWord">D：</span>';
										if(this.checkAnswerImg(list[i].answerD)){
											listStr += '<p><img src="'+ list[i].answerD +'"/></p>';
										}else{
											listStr += '<p>'+ list[i].answerD.replace("<","&lt") +'</p>';
										}
									listStr += '</div>';
								}
								if(list[i].answerE != ''){
									listStr += '<div class="comOpt layui-clear"><span class="queSelWord">E：</span>';
										if(this.checkAnswerImg(list[i].answerE)){
											listStr += '<p><img src="'+ list[i].answerE +'"/></p>';
										}else{
											listStr += '<p>'+ list[i].answerE.replace("<","&lt") +'</p>';
										}
									listStr += '</div>';
								}
								if(list[i].answerF != ''){
									listStr += '<div class="comOpt layui-clear"><span class="queSelWord">F：</span>';
										if(this.checkAnswerImg(list[i].answerF)){
											listStr += '<p><img src="'+ list[i].answerF +'"/></p>';
										}else{
											listStr += '<p>'+ list[i].answerF.replace("<","&lt") +'</p>';
										}
									listStr += '</div>';
								}
							listStr += '</div>';
							//答案
							listStr += '<div class="conAns"><span class="ansTit">答案：</span>';
							listStr += '<span class="ansTxtSpan">'+ list[i].queAnswer +'</span>';
							listStr += '</div>';
							//解析
							if(list[i].queResolution != ''){
								listStr += '<div class="con hasMargTop"><p class="titP">解析：</p><div>'+ list[i].queResolution +'</div></div>';
							}
							//关联此条
							if(list[i].lexTitle != '' && list[i].lexTitle != undefined){
								listStr += '<div class="queTips"><p class="titP">关联词条：</p><p class="tipsCon">'+ list[i].lexTitle +'</p></div>';
							}
							//提示
							if(list[i].queTipTitle != '' && list[i].queTipTitle != undefined){
								listStr += '<div class="queTips"><p class="titP">提示：</p><p class="tipsCon">'+ list[i].queTipTitle +'</p></div>';
							}
							listStr += '</div>';
						}
						$('#'+obj).html(listStr);
					}
				},
				//检查答案是否为图片
				checkAnswerImg : function(answer){
					if(answer.indexOf("jpg") > 0 || answer.indexOf("gif") > 0 || answer.indexOf("bmp") > 0 || answer.indexOf("png") > 0){
						return true;
					}
					return false;
				},
				//解题示范
				renderJtsfInfo : function(jtsfList){
					var jtsfStr = '';
					for(var i=0;i<jtsfList.length;i++){
						jtsfStr += '<div class="listLore">';
						jtsfStr += '<div class="con hasMargBot"><strong class="queTit">题干：</strong><div>'+ jtsfList[i].queSub +'</div></div>';
						jtsfStr += '<div class="con hasMargBot"><strong class="queTit">答案：</strong><div>'+ jtsfList[i].queAnswer +'</div></div>';
						jtsfStr += '<div class="con"><strong class="queTit">解析：</strong><div>'+ jtsfList[i].queResolution +'</div></div>';
						jtsfStr += '</div>';
					}
					$('#jtsfLore').html(jtsfStr);
				},
				//点拨指导
				renderDbzdInfo : function(dbzdList){
					var dbzdStr = '';
					for(var i=0;i<dbzdList.length;i++){
						if(i == 0){
							dbzdStr += '<div class="smModPart zhutiPart"><strong class="dbzdSmTit"><img src="../images/lubiao.png"/>';
							dbzdStr += '<span>'+ dbzdList[i].lqsType +'</span></strong>';
							dbzdStr += '<div class="listLore"><strong class="smTit">标题：'+ dbzdList[i].lqsTitle.replace("<","&lt") +'</strong>';
							dbzdStr += '<div class="con"><p class="titP">内容：</p><div>'+ dbzdList[i].lqsCon +'</div></div>';
							
						}else{
							if(dbzdList[i-1].lqsType == dbzdList[i].lqsType){
								dbzdStr += '<div class="listLore"><strong class="smTit">标题：'+ dbzdList[i].lqsTitle.replace("<","&lt") +'</strong>';
								dbzdStr += '<div class="con"><p class="titP">内容：</p><div>'+ dbzdList[i].lqsCon +'</div></div>';
							}else{
								dbzdStr += '<div class="smModPart zhutiPart"><strong class="dbzdSmTit"><img src="../images/lubiao.png"/>';
								dbzdStr += '<span>'+ dbzdList[i].lqsType +'</span></strong>';
								dbzdStr += '<div class="listLore"><strong class="smTit">标题：'+ dbzdList[i].lqsTitle.replace("<","&lt") +'</strong>';
								dbzdStr += '<div class="con"><p class="titP">内容：</p><div>'+ dbzdList[i].lqsCon +'</div></div>';
							}
						}
						dbzdStr += '</div>';
					}
					$('#dbzdLore').html(dbzdStr);
				},
				//知识清单
				renderZsqdInfo : function(zsqdList){
					var zsqdStr = '';
					for(var i=0;i<zsqdList.length;i++){
						zsqdStr += '<div class="listLore"><strong class="smTit">标题：'+ zsqdList[i].lqsTitle +'</strong>';
						zsqdStr += '<div class="con"><p class="titP">内容：</p><div>'+ zsqdList[i].lqsCon +'</div></div></div>';
					}
					$('#zsqdLore').html(zsqdStr);
				}
			};
			page.init();
		});
	</script>
</body> 
</html>